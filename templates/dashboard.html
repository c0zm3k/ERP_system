{% extends "base.html" %}

{% block title %}Dashboard - Lumen ERP{% endblock %}

{% block content %}
<div class="neumorph-card">
    <div class="profile-card profile-header"
        style="background: linear-gradient(145deg, var(--bg-color), #ffffff); box-shadow: 10px 10px 25px var(--shadow-dark), -10px -10px 25px var(--shadow-light);">
        <div
            style="width: 100px; height: 100px; border-radius: 30px; background: var(--header-blue); display: flex; align-items: center; justify-content: center; color: white; font-size: 2.5rem; font-weight: 900; box-shadow: 10px 10px 20px var(--shadow-dark), -5px -5px 15px var(--shadow-light); flex-shrink: 0;">
            {{ current_user.username[0].upper() }}
        </div>
        <div style="flex-grow: 1;">
            <h1 style="margin: 0; font-size: 2.2rem; color: var(--text-color); letter-spacing: -1px; line-height: 1.2;">
                Welcome, <span style="color: var(--primary-accent);">{{ current_user.username }}!</span></h1>
            <div
                style="margin-top: 15px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap; justify-content: inherit;">
                <span class="neumorph-btn"
                    style="padding: 5px 15px; font-size: 0.85rem; pointer-events: none; background: var(--secondary-accent); color: white; border-radius: 50px; box-shadow: none;">{{
                    current_user.role }}</span>
                <p style="margin: 0; opacity: 0.6; font-weight: 500; font-size: 1rem;">
                    {% if current_user.role == 'Faculty' %}
                    Department of <span style="color: var(--text-color);">{{ current_user.faculty_profile.department
                        }}</span>
                    {% elif current_user.role == 'Student' %}
                    <span style="color: var(--text-color);">{{ current_user.student_profile.department }}</span> &bull;
                    Class <span style="color: var(--text-color);">{{ current_user.student_profile.class_name }}</span>
                    {% else %}
                    System Administration Console
                    {% endif %}
                </p>
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        {% if current_user.role == 'Admin' %}
        <!-- Admin Cards -->
        <div class="neumorph-card"
            style="display: flex; flex-direction: column; justify-content: space-between; min-height: 250px; padding: 30px; border-bottom: 5px solid var(--primary-accent);">
            <div>
                <h3 style="margin-top: 0; font-size: 1.4rem; display: flex; align-items: center; gap: 10px;">ğŸ‘¥ User
                    Control</h3>
                <p style="opacity: 0.7; line-height: 1.6;">Manage Faculty and Student profiles, edit credentials, and
                    oversee account security.</p>
            </div>
            <a href="{{ url_for('manage_users') }}" class="neumorph-btn"
                style="text-align: center; text-decoration: none; padding: 15px; color: var(--primary-accent);">Open
                Directory</a>
        </div>

        <div class="neumorph-card"
            style="display: flex; flex-direction: column; justify-content: space-between; min-height: 250px; padding: 30px; border-bottom: 5px solid var(--secondary-accent);">
            <div>
                <h3 style="margin-top: 0; font-size: 1.4rem; display: flex; align-items: center; gap: 10px;">ğŸ« Class
                    Allotments</h3>
                <p style="opacity: 0.7; line-height: 1.6;">Assign specific subjects and classes to faculty members for
                    streamlined attendance tracking.</p>
            </div>
            <a href="{{ url_for('allot_class') }}" class="neumorph-btn"
                style="text-align: center; text-decoration: none; padding: 15px; color: var(--primary-accent);">Manage
                Allotments</a>
        </div>

        <div class="neumorph-card"
            style="display: flex; flex-direction: column; justify-content: space-between; min-height: 250px; padding: 30px; border-bottom: 5px solid var(--header-blue);">
            <div>
                <h3 style="margin-top: 0; font-size: 1.4rem; display: flex; align-items: center; gap: 10px;">ğŸ“… Academic
                    Tools</h3>
                <p style="opacity: 0.7; line-height: 1.6;">Construct and update the weekly academic schedule for the
                    entire department.</p>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <a href="{{ url_for('add_timetable') }}" class="neumorph-btn"
                    style="text-align: center; text-decoration: none; font-size: 0.9rem; padding: 12px 5px;">+ Add
                    Slot</a>
                <a href="{{ url_for('view_timetable') }}" class="neumorph-btn"
                    style="text-align: center; text-decoration: none; font-size: 0.9rem; padding: 12px 5px;">View
                    Table</a>
            </div>
        </div>

        {% elif current_user.role == 'Faculty' %}
        <!-- Faculty Dashboard -->
        <div class="neumorph-card" style="grid-column: 1 / -1; padding: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="margin: 0; font-size: 1.4rem;">ğŸ¯ Your Allotted Classes</h3>
                <span style="opacity: 0.5; font-size: 0.9rem;">{{ allotments|length }} active allotments</span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px;">
                {% for allotment in allotments %}
                <div class="neumorph-card"
                    style="margin: 0; box-shadow: 4px 4px 10px var(--shadow-dark), -2px -2px 8px var(--shadow-light); border-left: 6px solid var(--header-blue); padding: 20px; transition: transform 0.2s;">
                    <div style="font-weight: 800; font-size: 1.1rem; color: var(--header-blue);">{{ allotment.class_name
                        }}</div>
                    <div style="margin: 5px 0 20px; font-weight: 500; opacity: 0.7;">{{ allotment.subject }}</div>
                    <a href="{{ url_for('mark_attendance', allotment_id=allotment.id) }}" class="neumorph-btn"
                        style="text-decoration: none; font-size: 0.85rem; display: block; text-align: center; color: var(--primary-accent);">Mark
                        Attendance</a>
                </div>
                {% endfor %}
                {% if not allotments %}
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; opacity: 0.5;">
                    <p>No classes currently allotted. Please contact administration for your assignment.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="neumorph-card"
            style="display: flex; flex-direction: column; justify-content: space-between; min-height: 200px; padding: 30px;">
            <div>
                <h3 style="margin-top: 0;">ğŸ“š Academic Materials</h3>
                <p style="opacity: 0.7;">Upload and manage study notes, assignments, and resources for your students.
                </p>
            </div>
            <a href="{{ url_for('notes') }}" class="neumorph-btn"
                style="text-align: center; text-decoration: none; padding: 12px; color: var(--header-blue);">Open
                Repository</a>
        </div>

        {% elif current_user.role == 'Student' %}
        <!-- Student Dashboard -->
        <div class="neumorph-card"
            style="display: flex; flex-direction: column; justify-content: space-between; min-height: 250px; padding: 35px; text-align: center;">
            <div>
                <h3 style="margin-top: 0; font-size: 1.3rem;">ğŸ“Š Attendance Analytics</h3>
                <div style="margin: 25px 0;">
                    <div style="font-size: 3.5rem; font-weight: 900; color: var(--header-blue); line-height: 1;">View
                    </div>
                    <div
                        style="margin-top: 10px; font-weight: 600; opacity: 0.6; text-transform: uppercase; letter-spacing: 2px;">
                        Statistics</div>
                </div>
            </div>
            <a href="{{ url_for('view_attendance') }}" class="neumorph-btn"
                style="text-decoration: none; color: var(--primary-accent); padding: 15px; font-weight: 700;">Detailed
                History</a>
        </div>

        <div class="neumorph-card"
            style="display: flex; flex-direction: column; justify-content: space-between; min-height: 250px; padding: 35px; text-align: center;">
            <div>
                <h3 style="margin-top: 0; font-size: 1.3rem;">ğŸ“– Learning Resources</h3>
                <p style="opacity: 0.7; margin: 20px 0; line-height: 1.6;">Access all study materials, lecture notes,
                    and digital resources shared by your faculty.</p>
            </div>
            <a href="{{ url_for('notes') }}" class="neumorph-btn"
                style="text-decoration: none; color: var(--primary-accent); padding: 15px; font-weight: 700;">Download
                Materials</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}