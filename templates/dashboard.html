{% extends "base.html" %}

{% block title %}Dashboard - Lumen ERP{% endblock %}

{% block content %}
<div class="nm-card" style="max-width: 1200px; margin: 40px auto; padding: 40px; min-height: 80vh;">
    <!-- Welcome Header -->
    <div style="margin-bottom: 60px;">
        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
            <div class="nm-badge"
                style="width: 80px; height: 80px; font-size: 2rem; display: flex; align-items: center; justify-content: center; border-radius: 25px; color: var(--accent-color);">
                {{ current_user.username[0] | upper }}
            </div>
            <div>
                <h1 class="hero-text" style="margin-bottom: 5px;">Welcome back, {{ current_user.username }}!</h1>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <span class="nm-badge"
                        style="box-shadow: none; background: rgba(109, 93, 252, 0.1); color: var(--accent-color);">{{
                        current_user.role }}</span>
                    <span style="color: var(--text-secondary); font-weight: 700; font-size: 0.9rem;">Department: {{
                        current_user.department or 'General' }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Row -->
    <div class="grid-3" style="margin-bottom: 50px; gap: 30px;">
        <div class="nm-card" style="text-align: center; border-radius: var(--radius-lg); padding: 30px;">
            <div style="color: #6d5dfc; margin-bottom: 15px;">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="4"></circle>
                    <polyline points="17 11 19 13 23 9"></polyline>
                </svg>
            </div>
            <h3 style="font-weight: 800; margin-bottom: 5px;">Attendance</h3>
            <p style="font-size: 2rem; font-weight: 900; color: #2ecc71;">92%</p>
            <p style="font-size: 0.8rem; font-weight: 700; color: var(--text-secondary);">This Month</p>
        </div>
        <div class="nm-card" style="text-align: center; border-radius: var(--radius-lg); padding: 30px;">
            <div style="color: #ffa502; margin-bottom: 15px;">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
            </div>
            <h3 style="font-weight: 800; margin-bottom: 5px;">My Leaves</h3>
            <p style="font-size: 2rem; font-weight: 900;">{{ current_user.total_leaves - current_user.leaves_taken }} /
                {{ current_user.total_leaves }}</p>
            <p style="font-size: 0.8rem; font-weight: 700; color: var(--text-secondary);">Days remaining</p>
        </div>
        <div class="nm-card" style="text-align: center; border-radius: var(--radius-lg); padding: 30px;">
            <div style="color: #ff4757; margin-bottom: 15px;">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
            </div>
            <h3 style="font-weight: 800; margin-bottom: 5px;">System Status</h3>
            <p style="font-size: 2rem; font-weight: 900; color: #ff4757;">99.9%</p>
            <p style="font-size: 0.8rem; font-weight: 700; color: var(--text-secondary);">All systems normal</p>
        </div>
    </div>

    <!-- Actions & Context -->
    <div class="grid-2" style="gap: 40px;">
        <!-- Command Center -->
        <div class="nm-card" style="padding: 40px; border-radius: var(--radius-xl);">
            <h2
                style="font-weight: 900; margin-bottom: 30px; letter-spacing: -1.5px; display: flex; align-items: center; gap: 15px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent-color)"
                    stroke-width="3">
                    <path d="M12 2v20M2 12h20"></path>
                </svg>
                Quick Tools
            </h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                {% if current_user.role == 'Student' %}
                <a href="/my_attendance" class="nm-btn"
                    style="padding: 20px; font-size: 0.85rem; background: var(--surface-color); box-shadow: var(--nm-btn-hover);">My
                    Attendance</a>
                <a href="/attendance/analysis" class="nm-btn"
                    style="padding: 20px; font-size: 0.85rem; background: var(--surface-color); box-shadow: var(--nm-btn-hover);">Attendance
                    Analysis</a>
                {% endif %}
                <a href="/broadcasts" class="nm-btn"
                    style="padding: 20px; font-size: 0.85rem; background: var(--surface-color); box-shadow: var(--nm-btn-hover);">ðŸ“¢
                    Broadcasts</a>
                <a href="/leaves" class="nm-btn"
                    style="padding: 20px; font-size: 0.85rem; background: var(--surface-color); box-shadow: var(--nm-btn-hover);">Leave
                    History</a>
                <a href="/calendar" class="nm-btn"
                    style="padding: 20px; font-size: 0.85rem; background: var(--surface-color); box-shadow: var(--nm-btn-hover);">Holiday
                    Calendar</a>
                <a href="/fees" class="nm-btn"
                    style="padding: 20px; font-size: 0.85rem; background: var(--surface-color); box-shadow: var(--nm-btn-hover);">Fee
                    Portal</a>
                <a href="/notes" class="nm-btn"
                    style="padding: 20px; font-size: 0.85rem; background: var(--surface-color); box-shadow: var(--nm-btn-hover);">Study
                    Material</a>
            </div>
        </div>

        <!-- Academic Load / Info -->
        <div class="nm-inset" style="padding: 40px; border-radius: var(--radius-xl);">
            {% if current_user.role == 'Faculty' %}
            <h2 style="font-weight: 900; margin-bottom: 30px; letter-spacing: -1.5px;">My Assigned Classes</h2>
            {% for allotment in allotments %}
            <div class="nm-card"
                style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; padding: 20px 25px; border-radius: var(--radius-md); box-shadow: var(--nm-btn-hover);">
                <div>
                    <div style="font-weight: 800; font-size: 1rem;">{{ allotment.subject }}</div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); font-weight: 700;">{{ allotment.class_name }} &bull; {{ allotment.department }}{% if allotment.course %} &bull; {{ allotment.course }}{% if allotment.semester is not none %} Sem {{ allotment.semester }}{% endif %}{% endif %}</div>
                    {% if allotment.slot %}
                    <div style="font-size: 0.7rem; color: var(--accent-color); font-weight: 700; margin-top: 4px;">{{ allotment.slot.name }} â€“ {{ allotment.slot.day_of_week }} {{ allotment.slot.start_time }}-{{ allotment.slot.end_time }}</div>
                    {% endif %}
                </div>
                <a href="/attendance?allotment_id={{ allotment.id }}" class="nm-badge"
                    style="color: var(--accent-color); font-weight: 900; text-decoration: none;">Take Attendance</a>
            </div>
            {% else %}
            <div style="padding: 40px; text-align: center; color: var(--text-secondary); font-weight: 700;">No assigned classes yet.</div>
            {% endfor %}
            {% elif current_user.role == 'Admin' %}
            <h2 style="font-weight: 900; margin-bottom: 20px; letter-spacing: -1.5px;">System Governance</h2>
            <div class="nm-card"
                style="padding: 30px; border-radius: var(--radius-md); background: linear-gradient(135deg, #e0e5ec 0%, #d1d9e6 100%);">
                <p style="color: var(--text-secondary); font-weight: 600; margin-bottom: 25px;">Manage users,
                    teacher allotments, and system settings.</p>
                <a href="/admin" class="nm-btn"
                    style="width: 100%; padding: 15px; background: #31344b; color: white;">Open Admin Console</a>
            </div>
            {% else %}
            <h2 style="font-weight: 900; margin-bottom: 30px; letter-spacing: -1.5px;">My Classes &amp; Faculty</h2>
            {% if student_classes %}
            <div style="display: flex; flex-direction: column; gap: 15px;">
                {% for allotment in student_classes %}
                <div class="nm-card" style="padding: 22px 28px; border-radius: var(--radius-md); box-shadow: var(--nm-btn-hover);">
                    <div style="font-weight: 900; font-size: 1.05rem; color: var(--accent-color); margin-bottom: 8px;">{{ allotment.subject }}</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); font-weight: 700; margin-bottom: 10px;">
                        {{ allotment.class_name }}{% if allotment.course %} &bull; {{ allotment.course }}{% if allotment.semester is not none %} &bull; Sem {{ allotment.semester }}{% endif %}{% endif %}
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                        <span style="font-weight: 800; font-size: 0.85rem;">Faculty:</span>
                        <span style="font-weight: 700; font-size: 0.9rem;">{{ allotment.faculty_name or allotment.faculty.user.username }}</span>
                        <span style="font-size: 0.8rem; opacity: 0.85;">({{ allotment.faculty.designation }})</span>
                    </div>
                    {% if allotment.slot %}
                    <div style="font-size: 0.75rem; color: var(--accent-color); font-weight: 700; margin-top: 8px;">{{ allotment.slot.name }} â€“ {{ allotment.slot.day_of_week }} {{ allotment.slot.start_time }}-{{ allotment.slot.end_time }}</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="nm-inset" style="padding: 40px; border-radius: var(--radius-md); opacity: 0.7;">
                <p style="font-weight: 700; font-size: 0.9rem; color: var(--text-secondary);">No classes assigned to your batch yet. Your department/class/course/semester will appear here once the HOD assigns faculty.</p>
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}