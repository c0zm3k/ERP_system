{% extends "base.html" %}

{% block title %}Edit Timetable Slot - Lumen ERP{% endblock %}

{% block content %}
<div style="display: flex; justify-content: center; align-items: center; min-height: 60vh;">
    <div class="neumorph-card" style="width: 100%; max-width: 500px; padding: 40px;">
        <h2 style="text-align: center; margin-bottom: 30px;">Edit Slort</h2>
        <form method="POST">
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px;">Day</label>
                <select name="day" class="neumorph-inset" required>
                    {% for d in ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"] %}
                    <option value="{{ d }}" {% if slot.day==d %}selected{% endif %}>{{ d }}</option>
                    {% endfor %}
                </select>
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 12px; font-weight: 600;">Start Time</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select name="start_hour" id="start_hour" class="neumorph-inset" style="flex: 1;" required>
                        <option value="{{ times.sh }}">{{ times.sh }}</option>
                    </select>
                    <span>:</span>
                    <select name="start_minute" class="neumorph-inset" style="flex: 1;" required>
                        {% for i in range(0, 60, 5) %}
                        {% set m = '%02d' % i %}
                        <option value="{{ m }}" {% if times.sm==m %}selected{% endif %}>{{ m }}</option>
                        {% endfor %}
                    </select>
                    <select name="start_period" id="start_period" class="neumorph-inset" style="flex: 1;" required>
                        <option value="AM" {% if times.sp=='AM' %}selected{% endif %}>AM</option>
                        <option value="PM" {% if times.sp=='PM' %}selected{% endif %}>PM</option>
                    </select>
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <label style="display: block; margin-bottom: 12px; font-weight: 600;">End Time</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select name="end_hour" id="end_hour" class="neumorph-inset" style="flex: 1;" required>
                        <option value="{{ times.eh }}">{{ times.eh }}</option>
                    </select>
                    <span>:</span>
                    <select name="end_minute" class="neumorph-inset" style="flex: 1;" required>
                        {% for i in range(0, 60, 5) %}
                        {% set m = '%02d' % i %}
                        <option value="{{ m }}" {% if times.em==m %}selected{% endif %}>{{ m }}</option>
                        {% endfor %}
                    </select>
                    <select name="end_period" id="end_period" class="neumorph-inset" style="flex: 1;" required>
                        <option value="AM" {% if times.ep=='AM' %}selected{% endif %}>AM</option>
                        <option value="PM" {% if times.ep=='PM' %}selected{% endif %}>PM</option>
                    </select>
                </div>
            </div>

            <script>
                function updateHours(periodId, hourId, initialVal = null) {
                    const period = document.getElementById(periodId).value;
                    const hourSelect = document.getElementById(hourId);
                    const currentVal = initialVal || hourSelect.value;
                    hourSelect.innerHTML = '';

                    let hours = [];
                    if (period === 'AM') {
                        hours = ['06', '07', '08', '09', '10', '11'];
                    } else {
                        hours = ['12', '01', '02', '03', '04', '05', '06', '07', '08', '09'];
                    }

                    hours.forEach(h => {
                        const opt = document.createElement('option');
                        opt.value = h;
                        opt.textContent = h;
                        if (h === currentVal) opt.selected = true;
                        hourSelect.appendChild(opt);
                    });
                }

                document.getElementById('start_period').addEventListener('change', () => updateHours('start_period', 'start_hour'));
                document.getElementById('end_period').addEventListener('change', () => updateHours('end_period', 'end_hour'));

                // Initialize with values passed from backend
                updateHours('start_period', 'start_hour', "{{ times.sh }}");
                updateHours('end_period', 'end_hour', "{{ times.eh }}");
            </script>

            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Subject</label>
                <input type="text" name="subject" list="subject_list" value="{{ slot.subject }}" class="neumorph-inset"
                    required placeholder="Select or type subject...">
                <datalist id="subject_list">
                    {% for s in subjects %}
                    <option value="{{ s }}">
                        {% endfor %}
                </datalist>
            </div>

            <div style="display: flex; gap: 15px;">
                <button type="submit" class="neumorph-btn" style="flex: 1; color: var(--teal-cyan);">Update
                    Slot</button>
                <a href="{{ url_for('view_timetable') }}" class="neumorph-btn"
                    style="flex: 1; text-align: center; text-decoration: none;">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}